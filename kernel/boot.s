;Boot code of tulip operating system
;copyrights vigneashsundar @ 2015
; Multiboot specification , has two things namely magic and flags
;
;

BITS 32
ALIGN 4


MULTIBOOT_MAGIC equ 0x1BADB002;
MULTIBOOT_PAGE_ALIGN equ 1<<0 ;PAGE ALIGN 0 BIT
MULTIBOOT_MEMORY equ 1<<1 ; GETTING MEMORY MAP VIA BOOTLOADER
MULTIBOOT_GRAPHICS equ 1<<2 ; SETTING TO VIDEO MODE INSTEAD OF TEXT MODE
MULTIBOOT_HEADER_FLAG equ MULTIBOOT_PAGE_ALIGN| MULTIBOOT_MEMORY | MULTIBOOT_GRAPHICS
MULTIBOOT_CHECKSUM equ -(MULTIBOOT_HEADER_FLAG + MUTLIBOOT_MAGIC)  ; END RESULT UNSIGNED 0
MULTIBOOT_HEADER_ADD equ 0x00000000
MULTIBOOT_LOAD_ADD equ 0x00000000
MULTIBOOT_LOAD_END_ADD equ 0x00000000
MULTIBOOT_BSS_END_ADD equ  0x00000000
MULTIBOOT_ENTRY_ADD   equ  0X00000000
MULTIBOOT_GRAPHICS equ 0x00000000 
MULTIBOOT_WIDTH equ 0x00000000
MULTIBOOT_HEIGHT equ 0x00000000
MULTIBOOT_DEPTH equ 32 ; setting to 32bit resolution high color mode

;All multiboot header requirements are done , now init part

[GLOBAL multiboot]0x7ffff in decimal
[EXTERN code]
[EXTERN bss]
[EXTERN end]

multiboot:
	dd MULTIBOOT_MAGIC
	dd MULTIBOOT_HEADER_FLAG
	dd MULTIBOOT_CHECKSUM
	dd MULTIBOOT_HEADER_ADD
	dd MULTIBOOT_LOAD_ADD
	dd MULTIBOOT_LOAD_END_ADD
	dd MULTIBOOT_BSS_END_ADD
	dd MULTIBOOT_ENTRY_ADD
	dd MULTIBOOT_GRAPHICS
	dd MULTIBOOT_WIDTH
	dd MULTIBOOT_HEIGHT
	dd MULTIBOOT_DEPTH
	
[GLOBAL start]
[EXTERN vmain]

start:

	mov esp 0x7FFFF
	push esp
	
	push eax
	push ebx
	
	cli
	call vmain
	jmp $
	
	

